{"version":3,"file":"comments.js","sources":["webpack:///source/js/comments.js","webpack:///./source/js/tpl/one-comment.hbs"],"sourcesContent":["\"use strict\";\r\nimport Mn from 'backbone.marionette';\r\nimport Bb from 'backbone';\r\n\r\n// [{id:1,content:\"Комментарий\"}]\r\nconst Collection = Bb.Collection.extend({\r\nurl: \"/source/php/app/comments.php\"\r\n});\r\n\r\nlet commentsColl = window.app.comments;\r\n\r\nlet collection = new Collection(commentsColl);\r\n\r\n// console.log(window.app.img_id);\r\n\r\nconst CommentModel = Bb.Model.extend({\r\ndefaults: {\r\ncontent: \"\",\r\nimg_id: window.app.img_id\r\n}\r\n});\r\n\r\n\r\nconst emptyView = Mn.View.extend({\r\ntemplate(data){\r\nreturn _.template(\"<p>Комментариев пока нет.</p>\")();\r\n},\r\nclassName: \"empty-view\",\r\nreplaceElement:true,\r\nmodel: CommentModel\r\n});\r\n\r\n\r\nconst Comment = Mn.View.extend({\r\n\ttagName: \"li\",\r\n\r\ninitialize() {\r\n\r\nthis.listenTo(this.model, 'change:content', this.render);\r\n\r\nreturn this;\t\r\n},\r\n\r\ntemplate(data){\r\n return require('./tpl/one-comment.hbs')(data);\r\n\r\n},\r\n\r\nui: {\r\ndestroy: '.destroy',\r\nedit: '.edit'\r\n},\r\nevents: {\r\n'click @ui.destroy': 'remove',\r\n// 'click @ui.edit': 'edit'\r\n},\r\ntriggers: {\r\n'click @ui.edit': 'edit:comment'\r\n},\r\n\r\nremove() {\r\n\r\nlet view =  this;\r\n\r\n\tfunction react (model, resp) {\r\n\r\n\talert(resp.msg);\r\n\r\n};\r\n\r\nthis.model.destroy({ wait:true, success: react, error: react});\r\n\r\nreturn this;\r\n\r\n},\r\n\r\nedit() {\r\n\r\n\r\n\r\n// console.log('Редактирование комментария');\r\n\r\nreturn this;\r\n}\r\n\r\n\r\n});\r\n\r\n\r\n// Вид списка комментариев\r\n\r\nconst CommentsList  = Mn.CollectionView.extend({\r\nemptyView: emptyView,\r\ntagName:\"ol\",\r\nid:\"comments-list\",\r\nchildView: Comment,\r\nreplaceElement:true\r\n});\r\n\r\n\r\n// Блок комментариев\r\n\r\nconst CommentsBlock =  Mn.View.extend({\r\ncollection: collection,\r\nel:\"#comments\",\r\ntemplate:false,\r\nregions: {\r\nlist:{\r\nel:\"#comments-list\",\r\nreplaceElement: true\r\n}\r\n\r\n},\r\nui: {\r\nbutton: '.sbmt',\r\ntextarea: '.new-comment',\r\ndescript: 'p.descript', \r\ncancel: '.cancel'\r\n},\r\n\r\nevents:\r\n{\r\n'click @ui.button': 'addComment',\r\n'click @ui.cancel': 'cancel'\r\n},\r\n\r\ninitialize() {\r\n\r\nreturn this;\r\n},\r\n\r\nonRender(){\r\n\r\n\tthis.showChildView('list', new CommentsList({\r\n      collection: this.collection\r\n    }));\r\n\r\nreturn this;\r\n},\r\n\r\naction: 'create',\r\n\r\naddComment () {\r\n\r\nconsole.log(this.getOption('action'));\r\n\r\nlet textarea = this.getUI('textarea');\r\n\r\nlet content = $(textarea).val().trim();\r\n\r\nlet view =  this;\r\n\r\n\r\nif (!content) { alert('Ошибка! Введите текст комментария!');\r\n\r\nreturn false;\r\n}\r\n\r\nif (this.getOption('action') == \"create\")\r\n{\r\n\r\n\r\n// Создание нового комментария\r\n\r\nthis.collection.create({content: content,\r\nimg_id: window.app.img_id\r\n}, \r\n{wait:true,\r\nsuccess: function() {\r\n\t$(textarea).val('');}\r\n}\r\n);\r\n\r\n\r\n}\r\n\r\nelse {\r\n\r\nthis.editChild.model.save({content: content},\r\n{\r\n\twait:true, \r\n\tsuccess: function(model, resp) {\r\n\r\n\t$(textarea).val('');\r\n\r\nview.action = 'create';\r\n\r\nalert(resp.msg);\r\n\r\n\r\nview.getUI('descript').hide().fadeIn(300).text('Оставьте комментарий для потомков:');\r\n\r\n}\r\n});\r\n\r\n}\r\n\r\n},\r\n\r\nonChildviewEditComment(child) {\r\n\r\nlet oldText = child.model.get('content');\r\n\r\nlet textarea = this.getUI('textarea');\r\n\r\n$(textarea).val(oldText);\r\n\r\nthis.action = 'edit';\r\n\r\nthis.editChild = child;\r\n\r\nthis.getUI('descript').hide().fadeIn(300).text('Редактирование комментария:');\r\n\r\n},\r\n\r\ncancel() {\r\n\r\nthis.action = 'create';\r\n\r\nthis.getUI('descript').hide().fadeIn(300).text('Оставьте комментарий для потомков:');\r\n\r\nthis.getUI('textarea').val('');\r\n\r\n}\r\n\r\n});\r\n\r\nlet commentsBlock = new CommentsBlock();\r\n\r\ncommentsBlock.render();\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// source/js/comments.js","var Handlebars = require(\"D:\\\\Web\\\\domains\\\\gallery\\\\node_modules\\\\handlebars\\\\runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var helper;\n\n  return container.escapeExpression(((helper = (helper = helpers.content || (depth0 != null ? depth0.content : depth0)) != null ? helper : helpers.helperMissing),(typeof helper === \"function\" ? helper.call(depth0 != null ? depth0 : {},{\"name\":\"content\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\r\\n<p><span class=\\\"edit\\\">Редактировать</span> <span class=\\\"destroy\\\">Удалить</span></p>\";\n},\"useData\":true});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/tpl/one-comment.hbs\n// module id = 30\n// module chunks = 1"],"mappings":";;;;;;AAAA;AACA;AAAA;AACA;;;AAAA;AACA;;;;;AACA;AACA;AACA;AADA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AADA;AACA;AAOA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AANA;AACA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAIA;AACA;AADA;AAIA;AACA;AADA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAGA;AACA;AACA;AACA;AAlDA;AACA;AAuDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AACA;AAFA;AAOA;AACA;AACA;AACA;AACA;AAJA;AACA;AAMA;AAEA;AACA;AAFA;AACA;AAIA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AADA;AACA;AAGA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AADA;AAIA;AACA;AAAA;AAFA;AAOA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAbA;AAgBA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAzHA;AACA;AA4HA;AACA;;;;;;;;;ACpOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;","sourceRoot":""}